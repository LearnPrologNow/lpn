
<!--l. 372--> 
<div class="crosslinks"> 
<p class="noindent"> [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse53"> prev 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse53"> prev-tail 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse48"> tail 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=# "> up 
</a> ] 
</p> 
</div> 
<h3 class="sectionHead"> 
<span class="titlemark"> 12.3 
</span> 
<a id="x78-11500012.3"> 
</a> Reading from Files 
</h3> 
<!--l. 374--> 
<p class="noindent"> In this section we show how to read from files. Reading information from files is straightforward in Prolog &#8212; or at least, it is if this information is given in the form of Prolog terms followed by full stops. Consider the file 
<span class="verb"> 
<span class="cmtt-10"> houses.txt 
</span> 
</span> : 
</p> 
<!--l. 379--> 
<p class="indent"> 
</p> 
<div class="fancyvrb" id="fancyvrb569"> 
<a id="x78-115002r1"> 
</a> 
<span class="cmtt-10"> gryffindor. 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115004r2"> 
</a> 
<span class="cmtt-10"> hufflepuff. 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115006r3"> 
</a> 
<span class="cmtt-10"> ravenclaw. 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115008r4"> 
</a> 
<span class="cmtt-10"> slytherin. 
</span> 
</div> 
<!--l. 385--> 
<p class="noindent"> Here is a Prolog program that opens this file, reads 
<a id="dx78-115009"> 
</a> 
<a id="dx78-115010"> 
</a> the information from it, and displays it on the screen: 
</p> 
<!--l. 388--> 
<p class="indent"> 
</p> 
<div class="fancyvrb" id="fancyvrb570"> 
<a id="x78-115012r1"> 
</a> 
<span class="cmtt-10"> main:- 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115014r2"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;open(&#8217;houses.txt&#8217;,read,Str), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115016r3"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;read(Str,House1), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115018r4"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;read(Str,House2), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115020r5"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;read(Str,House3), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115022r6"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;read(Str,House4), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115024r7"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;close(Str), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115026r8"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;write([House1,House2,House3,House4]), 
</span> 
<span class="cmtt-10"> &#x00A0;nl. 
</span> 
</div> 
<!--l. 398--> 
<p class="noindent"> This opens a file in reading mode, then reads four Prolog terms using the built-in predicate 
<span class="verb"> 
<span class="cmtt-10"> read/2 
</span> 
</span> , closes the stream, and prints the information as a list. 
</p> 
<!--l. 402--> 
<p class="indent"> All very straightforward. Nonetheless, the 
<span class="verb"> 
<span class="cmtt-10"> read/2 
</span> 
</span> predicate needs to be handled with care. First of all, it only is able to handle Prolog terms (we&#8217;ll say more about this problem shortly). And secondly, it will cause a run-time error if we use it to read from a stream when there is nothing to read. Is there an elegant way to overcome this second problem? 
</p> 
<!--l. 409--> 
<p class="indent"> There is. The built-in predicate 
<span class="verb"> 
<span class="cmtt-10"> at_end_of_stream/1 
</span> 
</span> checks whether the end of a stream has been reached, and can be used as a safety-net. For a stream 
<span class="verb"> 
<span class="cmtt-10"> X 
</span> 
</span> , 
<span class="verb"> 
<span class="cmtt-10"> at_end_of_stream(X) 
</span> 
</span> will 
<a id="dx78-115027"> 
</a> evaluate to true when the end of the stream 
<span class="verb"> 
<span class="cmtt-10"> X 
</span> 
</span> is reached (in other words, when all terms in the corresponding file have been read). 
</p> 
<!--l. 416--> 
<p class="indent"> The following code is a modified version of our earlier reading-in program, which shows how 
<span class="verb"> 
<span class="cmtt-10"> at_end_of_stream/1 
</span> 
</span> can be incorporated: 
</p> 
<!--l. 419--> 
<p class="indent"> 
</p> 
<div class="fancyvrb" id="fancyvrb571"> 
<a id="x78-115029r1"> 
</a> 
<span class="cmtt-10"> main:- 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115031r2"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;open(&#8217;houses.txt&#8217;,read,Str), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115033r3"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;read_houses(Str,Houses), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115035r4"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;close(Str), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115037r5"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;write(Houses), 
</span> 
<span class="cmtt-10"> &#x00A0;nl. 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115039r6"> 
</a> 
<br class="fancyvrb" /> 
<a id="x78-115041r7"> 
</a> 
<span class="cmtt-10"> read_houses(Stream,[]):- 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115043r8"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;at_end_of_stream(Stream). 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115045r9"> 
</a> 
<br class="fancyvrb" /> 
<a id="x78-115047r10"> 
</a> 
<span class="cmtt-10"> read_houses(Stream,[X|L]):- 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115049r11"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;\+ 
</span> 
<span class="cmtt-10"> &#x00A0;at_end_of_stream(Stream), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115051r12"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;read(Stream,X), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115053r13"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;read_houses(Stream,L). 
</span> 
</div> 
<!--l. 435--> 
<p class="indent"> Now for the nastier problem. Recall that 
<span class="verb"> 
<span class="cmtt-10"> read/2 
</span> 
</span> only reads in Prolog terms. If you want to read in arbitrary input, things become rather unpleasant, as Prolog forces you to read information on the level of characters. The predicate that you need in this case is 
<span class="verb"> 
<span class="cmtt-10"> get_code/2 
</span> 
</span> which 
<a id="dx78-115054"> 
</a> reads the next available character from a stream. Characters are represented in Prolog by their integer codes. For example, 
<span class="verb"> 
<span class="cmtt-10"> get_code/2 
</span> 
</span> will return 
<span class="verb"> 
<span class="cmtt-10"> 97 
</span> 
</span> if the next character on the stream is an 
<span class="verb"> 
<span class="cmtt-10"> a 
</span> 
</span> . 
</p> 
<!--l. 444--> 
<p class="indent"> Usually we are not interested in these integer codes, but in the characters &#8212; or rather, in the atoms that are made up of lists of these characters. How do we get our hands on these (lists of) characters? One way is to use the built-in predicate 
<span class="verb"> 
<span class="cmtt-10"> atom_codes/2 
</span> 
</span> that 
<a id="dx78-115055"> 
</a> we introduced in Chapter&#x00A0; 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlch9"> 9 
<!--tex4ht:ref: CHAPTER9 --> 
</a> to convert a list of integers into the corresponding atom. We&#8217;ll use this technique in the following example, a predicate that reads in a word from a stream. 
</p> 
<!--l. 454--> 
<p class="indent"> 
</p> 
<div class="fancyvrb" id="fancyvrb572"> 
<a id="x78-115057r1"> 
</a> 
<span class="cmtt-10"> readWord(InStream,W):- 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115059r2"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;get_code(InStream,Char), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115061r3"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;checkCharAndReadRest(Char,Chars,InStream), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115063r4"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;atom_codes(W,Chars). 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115065r5"> 
</a> 
<br class="fancyvrb" /> 
<a id="x78-115067r6"> 
</a> 
<br class="fancyvrb" /> 
<a id="x78-115069r7"> 
</a> 
<span class="cmtt-10"> checkCharAndReadRest(10,[],_):- 
</span> 
<span class="cmtt-10"> &#x00A0;!. 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115071r8"> 
</a> 
<br class="fancyvrb" /> 
<a id="x78-115073r9"> 
</a> 
<span class="cmtt-10"> checkCharAndReadRest(32,[],_):- 
</span> 
<span class="cmtt-10"> &#x00A0;!. 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115075r10"> 
</a> 
<br class="fancyvrb" /> 
<a id="x78-115077r11"> 
</a> 
<span class="cmtt-10"> checkCharAndReadRest(-1,[],_):- 
</span> 
<span class="cmtt-10"> &#x00A0;!. 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115079r12"> 
</a> 
<br class="fancyvrb" /> 
<a id="x78-115081r13"> 
</a> 
<span class="cmtt-10"> checkCharAndReadRest(end_of_file,[],_):- 
</span> 
<span class="cmtt-10"> &#x00A0;!. 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115083r14"> 
</a> 
<br class="fancyvrb" /> 
<a id="x78-115085r15"> 
</a> 
<span class="cmtt-10"> checkCharAndReadRest(Char,[Char|Chars],InStream):- 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115087r16"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;get_code(InStream,NextChar), 
</span> 
<br class="fancyvrb" /> 
<a id="x78-115089r17"> 
</a> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0; 
</span> 
<span class="cmtt-10"> &#x00A0;checkCharAndReadRest(NextChar,Chars,InStream). 
</span> 
</div> 
<!--l. 474--> 
<p class="indent"> How does this work? It reads in a character and then checks whether this character is a blank (integer code 32), a new line (10) or the end of the stream ( 
<span class="cmsy-10"> - 
</span> 1). In any of these cases a complete word has been read, otherwise the next character is read. 
</p> 
<!--l. 480--> 
<div class="crosslinks"> 
<p class="noindent"> [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse53"> prev 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse53"> prev-tail 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse54"> front 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=# "> up 
</a> ] 
</p> 
</div> 
<!--l. 480--> 
<p class="indent"> 
<a id="taillpn-htmlse54"> 
</a> 
</p> 