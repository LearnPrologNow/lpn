
<!--l. 268--> 
<div class="crosslinks"> 
<p class="noindent"> [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse51"> next 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse43"> prev 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse43"> prev-tail 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse38"> tail 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse48"> up 
</a> ] 
</p> 
</div> 
<h3 class="sectionHead"> 
<span class="titlemark"> 10.2 
</span> 
<a id="x66-9700010.2"> 
</a> Using Cut 
</h3> 
<!--l. 270--> 
<p class="noindent"> Well, we now know what cut is. But how do we use it in practice, and why is it so useful? As a first example, let&#8217;s define a (cut-free) predicate 
<span class="verb"> 
<span class="cmtt-10"> max/3 
</span> 
</span> which takes integers as arguments 
<a id="dx66-97001"> 
</a> and succeeds if the third argument is the maximum of the first two. For example, the queries 
</p> 
<div class="fancyvrb" id="fancyvrb455"> 
<a id="x66-97003r1"> 
</a> 
<span class="cmtt-10"> ?- 
</span> 
<span class="cmtt-10"> &#x00A0;max(2,3,3). 
</span> 
</div> 
<!--l. 279--> 
<p class="indent"> and 
</p> 
<div class="fancyvrb" id="fancyvrb456"> 
<a id="x66-97005r1"> 
</a> 
<span class="cmtt-10"> ?- 
</span> 
<span class="cmtt-10"> &#x00A0;max(3,2,3). 
</span> 
</div> 
<!--l. 284--> 
<p class="indent"> and 
</p> 
<div class="fancyvrb" id="fancyvrb457"> 
<a id="x66-97007r1"> 
</a> 
<span class="cmtt-10"> ?- 
</span> 
<span class="cmtt-10"> &#x00A0;max(3,3,3). 
</span> 
</div> 
<!--l. 289--> 
<p class="indent"> should succeed, and the queries 
</p> 
<div class="fancyvrb" id="fancyvrb458"> 
<a id="x66-97009r1"> 
</a> 
<span class="cmtt-10"> ?- 
</span> 
<span class="cmtt-10"> &#x00A0;max(2,3,2). 
</span> 
</div> 
<!--l. 295--> 
<p class="indent"> and 
</p> 
<div class="fancyvrb" id="fancyvrb459"> 
<a id="x66-97011r1"> 
</a> 
<span class="cmtt-10"> ?- 
</span> 
<span class="cmtt-10"> &#x00A0;max(2,3,5). 
</span> 
</div> 
<!--l. 299--> 
<p class="noindent"> should fail. And of course, we also want the program to work when the third argument is a variable. That is, we want the program to be able to find the maximum of the first two arguments for us: 
</p> 
<div class="fancyvrb" id="fancyvrb460"> 
<a id="x66-97013r1"> 
</a> 
<span class="cmtt-10"> ?- 
</span> 
<span class="cmtt-10"> &#x00A0;max(2,3,Max). 
</span> 
<br class="fancyvrb" /> 
<a id="x66-97015r2"> 
</a> 
<br class="fancyvrb" /> 
<a id="x66-97017r3"> 
</a> 
<span class="cmtt-10"> Max 
</span> 
<span class="cmtt-10"> &#x00A0;= 
</span> 
<span class="cmtt-10"> &#x00A0;3 
</span> 
<br class="fancyvrb" /> 
<a id="x66-97019r4"> 
</a> 
<span class="cmtt-10"> yes 
</span> 
<br class="fancyvrb" /> 
<a id="x66-97021r5"> 
</a> 
<br class="fancyvrb" /> 
<a id="x66-97023r6"> 
</a> 
<span class="cmtt-10"> ?- 
</span> 
<span class="cmtt-10"> &#x00A0;max(2,1,Max). 
</span> 
<br class="fancyvrb" /> 
<a id="x66-97025r7"> 
</a> 
<br class="fancyvrb" /> 
<a id="x66-97027r8"> 
</a> 
<span class="cmtt-10"> Max 
</span> 
<span class="cmtt-10"> &#x00A0;= 
</span> 
<span class="cmtt-10"> &#x00A0;2 
</span> 
<br class="fancyvrb" /> 
<a id="x66-97029r9"> 
</a> 
<span class="cmtt-10"> yes 
</span> 
</div> 
<!--l. 316--> 
<p class="indent"> Now, it is easy to write a program that does this. Here&#8217;s a first attempt: 
</p> 
<div class="fancyvrb" id="fancyvrb461"> 
<a id="x66-97031r1"> 
</a> 
<span class="cmtt-10"> max(X,Y,Y):- 
</span> 
<span class="cmtt-10"> &#x00A0;X 
</span> 
<span class="cmtt-10"> &#x00A0;=&#x003C; 
</span> 
<span class="cmtt-10"> &#x00A0;Y. 
</span> 
<br class="fancyvrb" /> 
<a id="x66-97033r2"> 
</a> 
<span class="cmtt-10"> max(X,Y,X):- 
</span> 
<span class="cmtt-10"> &#x00A0;X&#x003E;Y. 
</span> 
</div> 
<!--l. 322--> 
<p class="noindent"> This is a perfectly correct program, and we might be tempted simply to stop here. But we shouldn&#8217;t: it&#8217;s not good enough. 
</p> 
<!--l. 325--> 
<p class="indent"> What&#8217;s the problem? There is a potential inefficiency. Suppose this definition is used as part of a larger program, and somewhere along the way 
<span class="verb"> 
<span class="cmtt-10"> max(3,4,Y) 
</span> 
</span> is called. The program will correctly set 
<span class="verb"> 
<span class="cmtt-10"> Y=4 
</span> 
</span> . But now consider what happens if at some stage backtracking is forced. The program will try to re-satisfy 
<span class="verb"> 
<span class="cmtt-10"> max(3,4,Y) 
</span> 
</span> using the second clause. This is completely pointless: the maximum of 
<span class="verb"> 
<span class="cmtt-10"> 3 
</span> 
</span> and 
<span class="verb"> 
<span class="cmtt-10"> 4 
</span> 
</span> is 
<span class="verb"> 
<span class="cmtt-10"> 4 
</span> 
</span> and that&#8217;s that. There is no second solution to find. To put it another way: the two clauses in the above program are mutually exclusive: if the first succeeds, the second must fail and vice versa. So attempting to re-satisfy this clause is a complete waste of time. 
</p> 
<!--l. 336--> 
<p class="indent"> With the help of cut, this is easy to fix. We need to insist that Prolog should never try both clauses, and the following code does this: 
</p> 
<div class="fancyvrb" id="fancyvrb462"> 
<a id="x66-97035r1"> 
</a> 
<span class="cmtt-10"> max(X,Y,Y) 
</span> 
<span class="cmtt-10"> &#x00A0;:- 
</span> 
<span class="cmtt-10"> &#x00A0;X 
</span> 
<span class="cmtt-10"> &#x00A0;=&#x003C; 
</span> 
<span class="cmtt-10"> &#x00A0;Y,!. 
</span> 
<br class="fancyvrb" /> 
<a id="x66-97037r2"> 
</a> 
<span class="cmtt-10"> max(X,Y,X) 
</span> 
<span class="cmtt-10"> &#x00A0;:- 
</span> 
<span class="cmtt-10"> &#x00A0;X&#x003E;Y. 
</span> 
</div> 
<!--l. 344--> 
<p class="indent"> Note how this works. Prolog will reach the cut if 
<span class="verb"> 
<span class="cmtt-10"> max(X,Y,Y) 
</span> 
</span> is called and 
<span class="verb"> 
<span class="cmtt-10"> X 
</span> 
<span class="cmtt-10"> &#x00A0;=&#x003C; 
</span> 
<span class="cmtt-10"> &#x00A0;Y 
</span> 
</span> succeeds. In this case, the second argument is the maximum, and that&#8217;s that, and the cut commits us to this choice. On the other hand, if 
<span class="verb"> 
<span class="cmtt-10"> X 
</span> 
<span class="cmtt-10"> &#x00A0;=&#x003C; 
</span> 
<span class="cmtt-10"> &#x00A0;Y 
</span> 
</span> fails, then Prolog goes onto the second clause instead. 
</p> 
<!--l. 350--> 
<p class="indent"> Note that this cut does 
<span class="cmti-10"> not 
</span> change the meaning of the program. Our new code gives exactly the same answers as the old one, but it&#8217;s more efficient. In fact, the program is 
<span class="cmti-10"> exactly 
</span> the same as the previous version, except for the cut, and this is a pretty good sign that the cut is a sensible one. Cuts like this, which don&#8217;t change the meaning of a program, have a special name: they&#8217;re called green cuts. 
</p> 
<!--l. 358--> 
<p class="indent"> But some readers will dislike this code. After all, isn&#8217;t the second line redundant? If we have to use this line, we already know that the first argument is bigger that the second. Couldn&#8217;t we squeeze out a little more efficiency with the help of our new cut construct? Let&#8217;s try. Here&#8217;s a first (faulty) attempt: 
</p> 
<div class="fancyvrb" id="fancyvrb463"> 
<a id="x66-97039r1"> 
</a> 
<span class="cmtt-10"> max(X,Y,Y) 
</span> 
<span class="cmtt-10"> &#x00A0;:- 
</span> 
<span class="cmtt-10"> &#x00A0;X 
</span> 
<span class="cmtt-10"> &#x00A0;=&#x003C; 
</span> 
<span class="cmtt-10"> &#x00A0;Y,!. 
</span> 
<br class="fancyvrb" /> 
<a id="x66-97041r2"> 
</a> 
<span class="cmtt-10"> max(X,Y,X). 
</span> 
</div> 
<!--l. 367--> 
<p class="noindent"> Note that is the same as our earlier green cut 
<span class="verb"> 
<span class="cmtt-10"> max/3 
</span> 
</span> , except that we have got rid of the 
<span class="verb"> 
<span class="cmtt-10"> &#x003E; 
</span> 
</span> test in the second clause. How good is it? Well, for some queries it&#8217;s fine. In particular, it answers correctly when we pose queries in which the third argument is a variable. For example: 
</p> 
<div class="fancyvrb" id="fancyvrb464"> 
<a id="x66-97043r1"> 
</a> 
<span class="cmtt-10"> ?- 
</span> 
<span class="cmtt-10"> &#x00A0;max(100,101,X). 
</span> 
<br class="fancyvrb" /> 
<a id="x66-97045r2"> 
</a> 
<br class="fancyvrb" /> 
<a id="x66-97047r3"> 
</a> 
<span class="cmtt-10"> X 
</span> 
<span class="cmtt-10"> &#x00A0;= 
</span> 
<span class="cmtt-10"> &#x00A0;101 
</span> 
<br class="fancyvrb" /> 
<a id="x66-97049r4"> 
</a> 
<span class="cmtt-10"> yes 
</span> 
</div> 
<!--l. 378--> 
<p class="indent"> and 
</p> 
<div class="fancyvrb" id="fancyvrb465"> 
<a id="x66-97051r1"> 
</a> 
<span class="cmtt-10"> ?- 
</span> 
<span class="cmtt-10"> &#x00A0;max(3,2,X). 
</span> 
<br class="fancyvrb" /> 
<a id="x66-97053r2"> 
</a> 
<br class="fancyvrb" /> 
<a id="x66-97055r3"> 
</a> 
<span class="cmtt-10"> X 
</span> 
<span class="cmtt-10"> &#x00A0;= 
</span> 
<span class="cmtt-10"> &#x00A0;3 
</span> 
<br class="fancyvrb" /> 
<a id="x66-97057r4"> 
</a> 
<span class="cmtt-10"> yes 
</span> 
</div> 
<!--l. 386--> 
<p class="indent"> Nonetheless, it&#8217;s 
<span class="cmti-10"> not 
</span> the same as the green cut program: the new 
<span class="verb"> 
<span class="cmtt-10"> max/3 
</span> 
</span> does 
<span class="cmti-10"> not 
</span> work correctly. Consider what happens when all three arguments are instantiated. For example, consider the query 
</p> 
<div class="fancyvrb" id="fancyvrb466"> 
<a id="x66-97059r1"> 
</a> 
<span class="cmtt-10"> ?- 
</span> 
<span class="cmtt-10"> &#x00A0;max(2,3,2). 
</span> 
</div> 
<!--l. 392--> 
<p class="noindent"> Obviously this query should fail. But in our new version, it will succeed! Why? Well, this query simply won&#8217;t unify with the head of the first clause, so Prolog goes straight to the second clause. And the query will unify with the second clause, and (trivially) the query succeeds! So maybe getting rid of that 
<span class="verb"> 
<span class="cmtt-10"> &#x003E; 
</span> 
</span> test wasn&#8217;t quite so smart after all. 
</p> 
<!--l. 399--> 
<p class="indent"> But there is another way. The problem with the new code is simply that we carried out variable unification 
<span class="cmti-10"> before 
</span> we traversed the cut. Suppose we handle our variables a little more intelligently (using three variables instead of two) and explicitly unify 
<span class="cmti-10"> after 
</span> we have crossed the cut: 
</p> 
<div class="fancyvrb" id="fancyvrb467"> 
<a id="x66-97061r1"> 
</a> 
<span class="cmtt-10"> max(X,Y,Z) 
</span> 
<span class="cmtt-10"> &#x00A0;:- 
</span> 
<span class="cmtt-10"> &#x00A0;X 
</span> 
<span class="cmtt-10"> &#x00A0;=&#x003C; 
</span> 
<span class="cmtt-10"> &#x00A0;Y,!, 
</span> 
<span class="cmtt-10"> &#x00A0;Y 
</span> 
<span class="cmtt-10"> &#x00A0;= 
</span> 
<span class="cmtt-10"> &#x00A0;Z. 
</span> 
<br class="fancyvrb" /> 
<a id="x66-97063r2"> 
</a> 
<span class="cmtt-10"> max(X,Y,X). 
</span> 
</div> 
<!--l. 408--> 
<p class="noindent"> As the reader should check, this program does work, and (as we hoped for) it avoids the explicit comparison made in the second clause of our green cut version of 
<span class="verb"> 
<span class="cmtt-10"> max/3 
</span> 
</span> . 
</p> 
<!--l. 412--> 
<p class="indent"> But there is an important difference between the new version of the program and the green cut version. The cut in the new program is a classic example of what is known as a red cut. As this terminology is supposed to suggest, such cuts are potentially dangerous. Why? Because if we take out such a cut, we 
<span class="cmti-10"> don&#8217;t 
</span> get an equivalent program. That is, if we remove the cut, the resulting code does 
<span class="cmti-10"> not 
</span> compute the maximum of two numbers any more. To put it another way, the presence of the cut is 
<span class="cmti-10"> indispensable 
</span> to the correct functioning of the program. (This was not the case in the green cut version &#8212; the cut there merely improved efficiency.) Because red cuts are indispensable cuts, their presence means that programs containing them are not fully declarative. Now, red cuts can be useful on occasions, but beware! Their use can lead to subtle programming mistakes and make code hard to debug. 
</p> 
<!--l. 429--> 
<p class="indent"> So, what to do? It&#8217;s probably best to work as follows. Try and get a good, clear, cut-free program working, and only then try to improve its efficiency by using cuts. Use green cuts whenever possible. Red cuts should be used only when absolutely necessary, and it&#8217;s a good idea to explicitly comment on any red cuts in your code. Working this way will maximise your chances of striking a good balance between declarative clarity and procedural efficiency. 
</p> 
<!--l. 437--> 
<div class="crosslinks"> 
<p class="noindent"> [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse51"> next 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse43"> prev 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse43"> prev-tail 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse44"> front 
</a> ] [ 
<a href="lpnpage.php?pagetype=html&pageid=lpn-htmlse48"> up 
</a> ] 
</p> 
</div> 
<!--l. 437--> 
<p class="indent"> 
<a id="taillpn-htmlse44"> 
</a> 
</p> 